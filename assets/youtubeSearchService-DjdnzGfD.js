const m="https://www.googleapis.com/youtube/v3";function w(e){if(!e)return null;const n=e.trim();if(/^[a-zA-Z0-9_-]{11}$/.test(n))return n;const s=e.match(/youtu\.be\/([a-zA-Z0-9_-]{11})/);if(s!=null&&s[1])return s[1];const t=e.match(/[?&]v=([a-zA-Z0-9_-]{11})/);return t!=null&&t[1]?t[1]:null}async function I(e){var t,r,a,i,c,u;const n="AIzaSyCuzsSgHYzMsRfDWHtGFlDhkYJfysD8DYw",s=new URLSearchParams({part:"snippet,contentDetails",id:e,key:n});try{const p=await fetch(`${m}/videos?${s}`);if(!p.ok)return null;const l=(t=(await p.json()).items)==null?void 0:t[0];if(!l)return null;const o=l.snippet.title||"",[d,f]=o.includes(" - ")?o.split(" - ",2):[void 0,o],h=((r=l.contentDetails)==null?void 0:r.duration)||"",b=T(h);return{id:`youtube:${e}`,title:f||o,artist:d||l.snippet.channelTitle,cover_url:((i=(a=l.snippet.thumbnails)==null?void 0:a.high)==null?void 0:i.url)||((u=(c=l.snippet.thumbnails)==null?void 0:c.default)==null?void 0:u.url),youtube_id:e,duration_ms:b,provider:"youtube"}}catch(p){return console.error("getYouTubeVideo error",p),null}}function T(e){try{const n=e.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);if(!n)return 0;const s=parseInt(n[1]||"0",10),t=parseInt(n[2]||"0",10),r=parseInt(n[3]||"0",10);return(s*3600+t*60+r)*1e3}catch{return 0}}async function $(e,n){const s="AIzaSyCuzsSgHYzMsRfDWHtGFlDhkYJfysD8DYw";try{const t=[],r=w(n?`${e} ${n}`:e);if(r){const o=await Y(r,s);if(o)return[{videoId:r,title:o.title,channel:o.channel,type:"official"}]}const a=`${e} ${n} official`.trim(),i=await y(a,s,3);t.push(...i.map(o=>({...o,type:"official"})));const c=`${e} ${n} live`.trim(),u=await y(c,s,2);t.push(...u.map(o=>({...o,type:"live"})));const p=`${n||e} cover`.trim(),v=await y(p,s,2);return t.push(...v.map(o=>({...o,type:"cover"}))),t.filter((o,d,f)=>f.findIndex(h=>h.videoId===o.videoId)===d)}catch(t){return console.error("Error searching YouTube:",t),[]}}async function y(e,n,s){const t=new URLSearchParams({part:"snippet",q:e,type:"video",videoCategoryId:"10",maxResults:s.toString(),key:n}),r=await fetch(`${m}/search?${t}`);return r.ok?(await r.json()).items.map(i=>({videoId:i.id.videoId,title:i.snippet.title,channel:i.snippet.channelTitle})):(console.error("YouTube API error:",r.status),[])}async function Y(e,n){var i,c,u;const s=new URLSearchParams({part:"snippet",id:e,key:n}),t=await fetch(`${m}/videos?${s}`);if(!t.ok)return null;const a=(i=(await t.json()).items)==null?void 0:i[0];return a?{title:((c=a.snippet)==null?void 0:c.title)||"YouTube video",channel:((u=a.snippet)==null?void 0:u.channelTitle)||"YouTube"}:null}export{I as g,$ as s};
